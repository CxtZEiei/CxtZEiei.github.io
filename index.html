<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Perfect Surprise Final</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap" rel="stylesheet" />
  <style>
    /* ================= จุดที่เพิ่มเพื่อให้ปรับสัดส่วนได้ ================= */
    body {
      touch-action: manipulation; /* ป้องกันการซูมมั่วซั่วในมือถือ */
    }
    /* ========================================================== */

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Quicksand', sans-serif; }
    body { 
      width: 100vw; height: 100vh; background: #fff0f5; 
      display: flex; justify-content: center; align-items: center; 
      overflow: hidden; position: relative; 
    }
    
    .bg-heart {
      position: absolute; bottom: -50px; color: rgba(255, 105, 180, 0.4);
      font-size: 20px; user-select: none; pointer-events: none; z-index: 0;
      animation: floatAndFade linear forwards;
    }

    @keyframes floatAndFade {
      0% { transform: translateY(0) rotate(0deg); opacity: 0; }
      10% { opacity: 0.5; }
      80% { opacity: 0.5; }
      100% { transform: translateY(var(--float-distance)) rotate(var(--rotate)); opacity: 0; }
    }

    .container { 
      width: 90vmin; height: 55vmin; background: #fff; border-radius: 20px; 
      box-shadow: 0 8px 16px rgba(0,0,0,0.1); padding: 20px; 
      display: flex; flex-direction: column; align-items: center; 
      position: relative; overflow: hidden; z-index: 1; 
    }

    .screen { 
      position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
      padding: 20px; display: flex; flex-direction: column; align-items: center; 
      opacity: 0; pointer-events: none; transform: translateY(30px); 
      transition: opacity 1s ease, transform 1s ease; 
    }
    .screen.active { opacity: 1; pointer-events: all; transform: translateY(0); }

    .title { font-size: 1.5em; color: #ff69b4; margin-bottom: 16px; }

    .image-frame { 
      width: 60vmin; height: 32vmin; border-radius: 16px; 
      background: #ffeef7; border: 2px dashed #ff9ac1; 
      display: flex; justify-content: center; align-items: center; 
      overflow: hidden; margin-bottom: 18px; cursor: pointer;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
    }
    .image-frame:hover { transform: scale(1.05) rotate(-1deg); border-style: solid; border-color: #ff69b4; }
    .image-frame img { width: 100%; height: 100%; object-fit: contain; border-radius: 12px; }
    
    .button-group { display: flex; gap: 20px; align-items: center; justify-content: center; min-height: 80px; }
    
    button { 
      padding: 12px 36px; font-size: 1.2em; background: #ff69b4; color: white; 
      border: none; border-radius: 20px; cursor: pointer; 
      transform: scale(var(--base-scale, 1));
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
      box-shadow: 0 4px 8px rgba(0,0,0,0.05); 
      position: relative; overflow: hidden;
    }
    button:hover:enabled { background: #ff4a9d; transform: scale(calc(var(--base-scale, 1) * 1.1)); box-shadow: 0 0 20px rgba(255, 105, 180, 0.6); }
    button:disabled { background: #ccc !important; cursor: not-allowed; transform: scale(1) !important; }

    button::after {
      content: ''; position: absolute; top: -50%; left: -100%; width: 50%; height: 200%;
      background: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.6) 50%, rgba(255, 255, 255, 0) 100%);
      transform: rotate(25deg); transition: none;
    }
    button:hover:enabled::after { animation: shine 0.8s ease-in-out; }
    @keyframes shine { 0% { left: -100%; } 100% { left: 150%; } }
    
    #exitBtn { background: #ff4444; position: relative; z-index: 100; transition: left 0.4s cubic-bezier(0.2, 1, 0.3, 1), top 0.4s cubic-bezier(0.2, 1, 0.3, 1), transform 0.4s cubic-bezier(0.2, 1, 0.3, 1), opacity 0.4s ease; will-change: left, top, transform; }

    .top-frame { 
      position: absolute; top: 70px; left: 80%; transform: translateX(-50%); 
      width: 250px; height: 50px; border: 2px solid #ffa0c5; 
      background: #fffafc; border-radius: 12px; display: flex; 
      align-items: center; justify-content: center; color: #ff69b4; font-weight: bold; 
      z-index: 1; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
    }
    .top-frame:hover { transform: translateX(-50%) scale(1.1) rotate(2deg); border-style: solid; border-color: #ff69b4; }

    #record { 
      width: 200px; height: 200px; cursor: pointer; 
      background: url('images/Disk.png') no-repeat center center; background-size: cover; 
      position: absolute; top: 20px; left: 20px; border-radius: 50%; 
      box-shadow: 0 0 8px #ff69b4aa; animation: spin 4s linear infinite; 
      animation-play-state: paused; z-index: 10;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    .message-box { 
      width: 80%; height: 75%; margin-top: 140px; margin-bottom: 20px; 
      background: #ffeef7; border: 2px solid #ff9ac1; border-radius: 16px; 
      display: flex; align-items: center; justify-content: center; overflow: hidden; padding: 15px;
    }

    .content-img {
      max-width: 90%; max-height: 90%; object-fit: contain; transition: transform 0.3s ease, filter 0.3s ease;
      border-radius: 10px; backface-visibility: hidden; -webkit-backface-visibility: hidden; transform: translateZ(0); 
    }
    .content-img:hover { transform: scale(1.05); filter: brightness(1.05); } 

    .envelope-container-click { 
      position: relative; width: 200px; height: 150px; cursor: pointer;
      transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 5;
    }
    .envelope-container-click.zoom { transform: scale(1.2); }

    .mail { position: absolute; width: 200px; height: 150px; bottom: 0; }
    .mail .back-fold { position: absolute; width: 200px; height: 102px; background: #cf4a43; bottom: 0; z-index: 0; border-radius: 0 0 8px 8px; }
    .mail .body { position: absolute; width: 0; height: 0; border-style: solid; border-width: 0 0 100px 200px; border-color: transparent transparent #e95f66 transparent; bottom: 0; z-index: 2; }
    .mail .left-fold { position: absolute; bottom: 0; width: 0; height: 0; border-style: solid; border-width: 50px 0 50px 102px; border-color: transparent transparent transparent #e15349; z-index: 2; }
    
    .mail .top-fold { 
      position: absolute; width: 0; height: 0; border-style: solid; border-width: 52px 100px 0 100px;
      border-color: #cf4a43 transparent transparent transparent; top: 48.5px; transform-origin: top; 
      z-index: 3; transition: transform 0.6s ease, z-index 0.2s; 
    }

    #nextBtn2 { padding: 15px 40px; font-size: 1.2em; width: auto; margin-top: 1px; }

    .envelope-container-click.open .top-fold { transform: rotateX(180deg); z-index: 0; }
    
    .mail .letter {
      position: absolute; left: 50%; transform: translateX(-50%) translateZ(0); bottom: 10px; 
      width: 90%; height: 0; background: white; z-index: 1; overflow: hidden; border-radius: 8px; 
      box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: height 0.6s ease, bottom 0.6s ease, transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
      image-rendering: -webkit-optimize-contrast; backface-visibility: hidden; -webkit-font-smoothing: antialiased;
    }
    .letter img { width: 100%; height: auto; display: block; }

    .envelope-container-click.open .letter { height: 100px; bottom: 30px; }
    .letter.floating { bottom: 100px !important; }
    .letter.zoomed { transform: translateX(-50%) translateY(8vh) scale(3) !important; z-index: 1000; box-shadow: 0 10px 50px rgba(0,0,0,0.3); }

    /* หัวใจแอนิเมชันตอนเปิดซอง (มึงเอาแบบเดิมเป๊ะ) */
    .heart1, .heart2, .heart3 { position: absolute; transform: rotate(45deg); animation: flyHeart 2.8s ease-out forwards; z-index: 10; }
    .heart1 { width: 10px; height: 10px; background: radial-gradient(circle at 30% 30%, #ffc0cb, #ff69b4); border-radius: 5px 5px 10px 10px; }
    .heart1::before, .heart1::after { content: ''; position: absolute; width: 100%; height: 100%; background: inherit; border-radius: 50%; }
    .heart1::before { top: -50%; left: 0; } .heart1::after { top: 0; left: -50%; }
    
    .heart2 { width: 12px; height: 12px; background: linear-gradient(135deg, #ff8da1, #ff416c); border-radius: 50%; }
    .heart2::before, .heart2::after { content: ''; position: absolute; width: 100%; height: 100%; background: inherit; border-radius: 50%; }
    .heart2::before { top: -50%; left: 0; } .heart2::after { top: 0; left: -50%; }
    
    .heart3 { width: 8px; height: 8px; background: radial-gradient(circle at 30% 30%, #ffb6c1, #e75480); border-radius: 50%; }
    .heart3::before, .heart3::after { content: ''; position: absolute; width: 100%; height: 100%; background: inherit; border-radius: 50%; }
    .heart3::before { top: -50%; left: 0; } .heart3::after { top: 0; left: -50%; }

    @keyframes flyHeart {
      0% { opacity: 1; transform: translate(0, 0) scale(1) rotate(45deg); }
      100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(1.7) rotate(90deg); }
    }
  </style>
</head>
<body>

  <div class="container">
    <div id="screen1" class="screen active">
      <div class="title">PREPARE FOR SURPRISE ?</div>
      <div class="image-frame"><img src="images/cute.gif" alt="Cute gif"></div>
      <div class="button-group">
        <button id="exitBtn">EXIT</button>
        <button id="nextBtn" onclick="startCountdown()">NEXT</button>
      </div>
      <div id="countdown" style="color:#ff69b4; margin-top:10px; min-height: 1.5em;"></div>
    </div>

    <div id="screen2" class="screen">
      <div class="top-frame">For Mr.Devlover</div>
      <div id="record"></div>
      <audio id="audio" src="audio/Blue Yung Kai.mp3"></audio>
      <div class="message-box">
        <img src="images/cc.gif" alt="Surprise" class="content-img">
      </div>
      <button id="nextBtn2" onclick="showEnvelope()" disabled>NEXT SURPRISE</button>
    </div>

    <div id="envelopeScreen" class="screen" style="justify-content: center;">
      <div id="envelopeClick" class="envelope-container-click">
        <div class="mail">
          <div class="back-fold"></div>
          <div id="letter" class="letter"><img src="images/page.png" alt="Letter Message"></div>
          <div class="top-fold"></div>
          <div class="body"></div>
          <div class="left-fold"></div>
        </div>
        <div class="heart-container" style="position: absolute; top: 0; left: 0; width: 200px; height: 150px; pointer-events: none; z-index: 10;"></div>
      </div>
    </div>
  </div>

  <script>
    // --- จุดที่เพิ่ม: ฟังก์ชันปรับสเกลอัตโนมัติเพื่อให้หน้าตาเหมือนกันทุกจอ ---
    function autoResize() {
      const windowWidth = window.innerWidth;
      const windowHeight = window.innerHeight;
      
      // อ้างอิงขนาดที่มึงเขียน (90vmin x 55vmin)
      // ถ้าเปิดในที่แคบมากๆ (เช่น มือถือแนวตั้ง) เราจะสั่งซูมออก
      if (windowWidth < windowHeight) {
        // คำนวณอัตราส่วนการย่อ (เพื่อให้กล่องกว้าง 90% ของหน้าจอ)
        const scale = windowWidth / (windowWidth * 1.1); 
        document.body.style.zoom = scale;
      } else {
        document.body.style.zoom = "1";
      }
    }
    window.addEventListener('load', autoResize);
    window.addEventListener('resize', autoResize);
    // -----------------------------------------------------------

    function createBackgroundHeart() {
      const heart = document.createElement('div');
      heart.className = 'bg-heart';
      const colors = ['#ffc0cb', '#ffb6c1', '#ff91a4', '#f8b9d4', '#ffd1dc'];
      const randomColor = colors[Math.floor(Math.random() * colors.length)];
      const size = Math.random() * (17 - 30) + 30;
      heart.innerHTML = `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="${randomColor}"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`;
      heart.style.left = Math.random() * 100 + 'vw';
      heart.style.opacity = Math.random() * 0.3 + 0.2;
      const targetHeight = -(Math.random() * 20 + 70);
      heart.style.setProperty('--float-distance', targetHeight + 'vh');
      heart.style.setProperty('--rotate', (Math.random() * 360) + 'deg');
      const duration = Math.random() * 5 + 10;
      heart.style.animationDuration = duration + 's';
      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), duration * 1000);
    }
    setInterval(createBackgroundHeart, 1500);

    let exitClickCount = 0;
    const exitBtn = document.getElementById('exitBtn');
    const nextBtn = document.getElementById('nextBtn');
    const screen1 = document.getElementById('screen1');
    
    exitBtn.addEventListener('click', () => {
      exitClickCount++;
      if (exitClickCount >= 4) { exitBtn.style.display = 'none'; } 
      else {
        exitBtn.style.transform = `scale(${1 - exitClickCount * 0.2})`;
        nextBtn.style.setProperty('--base-scale', 1 + exitClickCount * 0.3);
        const rect = screen1.getBoundingClientRect();
        exitBtn.style.position = 'absolute';
        exitBtn.style.left = Math.random() * (rect.width - 150) + 'px';
        exitBtn.style.top = Math.random() * (rect.height - 100) + 'px';
      }
    });

    function startCountdown() {
      nextBtn.disabled = true; exitBtn.style.display = 'none'; 
      const countdownEl = document.getElementById('countdown');
      let seconds = 5;
      const interval = setInterval(() => {
        countdownEl.innerText = `Redirecting in ${seconds--}...`;
        if (seconds < 0) {
          clearInterval(interval);
          document.getElementById('screen1').classList.remove('active');
          document.getElementById('screen2').classList.add('active');
        }
      }, 1000);
    }

    const record = document.getElementById('record');
    const audio = document.getElementById('audio');
    const nextBtn2 = document.getElementById('nextBtn2'); 
    let isPlaying = false;
    record.addEventListener('click', () => {
      if (isPlaying) { audio.pause(); record.style.animationPlayState = 'paused'; isPlaying = false; } 
      else { audio.play(); record.style.animationPlayState = 'running'; isPlaying = true; nextBtn2.disabled = false; }
    });

    function showEnvelope() {
      document.getElementById('screen2').classList.remove('active');
      document.getElementById('envelopeScreen').classList.add('active');
    }

    let envelopeOpened = false;
    let isTransitioning = false;
    const envelopeClick = document.getElementById('envelopeClick');
    const letter = document.getElementById('letter');

    envelopeClick.addEventListener('click', () => {
      if (isTransitioning) return;
      if (!envelopeOpened) {
        isTransitioning = true;
        envelopeClick.classList.add('zoom');
        setTimeout(() => {
          envelopeClick.classList.add('open');
          envelopeOpened = true;
          releaseHearts(15);
          isTransitioning = false;
        }, 600);
      } else {
        if (!letter.classList.contains('zoomed')) {
          isTransitioning = true; 
          letter.classList.add('floating');
          setTimeout(() => {
            letter.classList.add('zoomed');
            isTransitioning = false;
          }, 600);
        }
      }
    });

    function releaseHearts(count) {
      const heartContainer = document.querySelector('.heart-container');
      const heartTypes = ['heart1', 'heart2', 'heart3'];
      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          const heart = document.createElement('div');
          heart.className = heartTypes[i % 3];
          heart.style.left = '100px'; heart.style.top = '70px';
          heart.style.setProperty('--dx', (Math.random() - 0.5) * 250 + 'px');
          heart.style.setProperty('--dy', -(150 + Math.random() * 100) + 'px');
          heartContainer.appendChild(heart);
          setTimeout(() => heart.remove(), 3000);
        }, i * 150);
      }
    }
  </script>
</body>
</html>